- name: Check if homebrew is installed
  shell: brew info >/dev/null 2>&1
  register: does_brew_exists
  ignore_errors: yes

- name: Install homebrew
  shell: '/bin/bash -c "$(curl -fsSL https://raw.githubusercontent.com/Homebrew/install/HEAD/install.sh)"'
  when: does_brew_exists.rc != 0

- name: Install packages
  homebrew:
    name: "{{ common_packages + os_specific_packages }}"
    state: latest

